<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Resource Pack Builder | Skythoria Tools</title>
  <style>
    @font-face {
      font-family: 'Minecraft';
      src: url('/assets/MinecraftRegular.woff') format('woff');
    }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #111;
      color: #EEE;
      margin: 0;
    }
    .nav {
      background: #1b1b1b;
      padding: 10px 20px;
      text-align: center;
      border-bottom: 2px solid #FF3B3F;
    }
    .nav a {
      color: #FF3B3F;
      text-decoration: none;
      margin: 0 15px;
      font-weight: bold;
    }
    .nav a:hover {
      text-decoration: underline;
    }
    header, section {
      max-width: 1000px;
      margin: 20px auto;
      padding: 20px;
      background: #222;
      border-radius: 8px;
    }
    h1, h2 {
      color: #FF3B3F;
      font-family: 'Minecraft', monospace;
      margin-top: 0;
    }
    p, ul {
      line-height: 1.6;
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }
    input[type="text"], input[type="file"] {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      background: #2d2d2d;
      color: #EEE;
      border: 1px solid #444;
      border-radius: 4px;
    }
    button, .copy-btn {
      margin-top: 15px;
      padding: 10px 20px;
      background: #FF3B3F;
      color: #fff;
      border: none;
      border-radius: 4px;
      font-size: 1em;
      cursor: pointer;
    }
    .copy-btn {
      display: inline-block;
      margin-left: 10px;
      vertical-align: middle;
    }
    button:hover, .copy-btn:hover {
      background: #e03335;
    }
    .give-preview {
      width: 100%;
      padding: 8px;
      background: #2d2d2d;
      color: #0f0;
      border-radius: 4px;
      margin-top: 5px;
      word-break: break-all;
    }
  </style>
</head>
<body>
  <div class="nav">
    <a href="/">Home</a>
    <a href="/tools/index.html">Tools</a>
    <a href="https://discord.gg/NCtM5fMY" target="_blank">Discord</a>
  </div>

  <section>
    <h1>Resource Pack Builder</h1>
    <p>This tool creates a working Minecraft 1.21.6+ resource pack using a model and texture exported from Blockbench.</p>
    <h2>Instructions</h2>
    <ul>
      <li>üì¶ Use <a href="https://blockbench.net/" target="_blank">Blockbench</a> to design your item model and texture.</li>
      <li>üíæ Export the model as a <strong>Java Edition .json</strong> file.</li>
      <li>üé® Save the texture as a <strong>.png</strong> file.</li>
      <li>üóÇ Upload both files below along with a name and base item.</li>
      <li>üéÅ This tool outputs a valid resource pack folder (not zipped) with correct structure and paths.</li>
      <li>üí¨ You also get a working <code>/give</code> command to test the item in-game.</li>
      <li>üß† Hint: Use a different <strong>base item</strong> for each custom model to avoid override issues.</li>
    </ul>

    <label>Pack Name:</label>
    <input type="text" id="packName" placeholder="Example: SkythoriaPack">

    <label>Custom Model ID (string):</label>
    <input type="text" id="itemId" placeholder="Example: bat">

    <label>Base Item to Override (e.g. mace):</label>
    <input type="text" id="baseItem" placeholder="Example: mace">

    <label>Model File (.json from Blockbench):</label>
    <input type="file" id="modelFile" accept=".json">

    <label>Texture File (.png):</label>
    <input type="file" id="textureFile" accept=".png">

    <button id="generatePack">Generate Resource Pack</button>

    <label>Give Command:</label>
    <div>
      <span class="give-preview" id="giveCommand"></span>
      <button class="copy-btn" id="copyBtn">Copy</button>
    </div>

    <label>Download:</label>
    <a id="downloadLink" class="button" style="display:none;">Download Pack Folder</a>
  </section>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script>
    function updateGive() {
      const base = document.getElementById('baseItem').value.trim();
      const id = document.getElementById('itemId').value.trim();
      const preview = document.getElementById('giveCommand');
      if (base && id) {
        preview.textContent = `/give @p ${base}[minecraft:custom_model_data={strings:["${id}"]}]`;
      } else {
        preview.textContent = '';
      }
    }

    document.getElementById('baseItem').addEventListener('input', updateGive);
    document.getElementById('itemId').addEventListener('input', updateGive);

    document.getElementById('copyBtn').addEventListener('click', () => {
      const text = document.getElementById('giveCommand').textContent;
      if (!text) return;
      navigator.clipboard.writeText(text).then(() => alert('Copied!'));
    });

    document.getElementById('generatePack').addEventListener('click', () => {
      const pack = document.getElementById('packName').value.trim();
      const id = document.getElementById('itemId').value.trim();
      const base = document.getElementById('baseItem').value.trim();
      const model = document.getElementById('modelFile').files[0];
      const texture = document.getElementById('textureFile').files[0];

      if (!pack || !id || !base || !model || !texture) {
        return alert("Fill all fields and select files!");
      }

      const zip = new JSZip();

      // pack.mcmeta
      zip.file("pack.mcmeta", JSON.stringify({
        pack: { pack_format: 63, description: pack }
      }, null, 4));

      // Build paths
      const selectorPath = `assets/minecraft/items/${base}.json`;
      const modelPath = `assets/minecraft/models/item/${id}.json`;
      const texturePath = `assets/minecraft/textures/item/${id}.png`;

      // Add selector JSON
      zip.file(selectorPath, JSON.stringify({
        model: {
          type: "select",
          property: "custom_model_data",
          fallback: { type: "model", model: `item/${base}` },
          cases: [
            { when: id, model: { type: "model", model: `item/${id}` } }
          ]
        }
      }, null, 4));

      const readerModel = new FileReader();
      const readerTexture = new FileReader();

      readerModel.onload = () => {
        const json = JSON.parse(readerModel.result);
        json.textures = {
          "0": `minecraft:item/${id}`,
          "particle": `minecraft:item/${id}`
        };
        zip.file(modelPath, JSON.stringify(json, null, 4));
      };

      readerTexture.onload = () => {
        zip.file(texturePath, readerTexture.result);
      };

      readerModel.readAsText(model);
      readerTexture.readAsArrayBuffer(texture);

      Promise.all([
        new Promise(r => readerModel.onloadend = r),
        new Promise(r => readerTexture.onloadend = r)
      ]).then(() => {
        zip.generateAsync({ type: "blob" }).then(blob => {
          const link = document.getElementById('downloadLink');
          link.href = URL.createObjectURL(blob);
          link.download = `${pack}.zip`;
          link.style.display = "inline-block";
          link.textContent = `Download ${pack}.zip`;
        });
      });
    });
  </script>
</body>
</html>
